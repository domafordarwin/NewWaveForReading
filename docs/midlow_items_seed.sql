-- =========================================================
-- 리딩 PRO 문해력 진단 평가 [중등 저] 문항지 적재 스크립트 (초안)
-- 대상 테이블: stimuli, item_bank, item_options
-- 주의:
-- 1) 보기 텍스트는 OCR 기반이라 일부 오타가 있을 수 있습니다. (교사 검토 단계에서 수정 권장)
-- 2) 정답/채점루브릭/영역 매핑(item_keys, rubrics, item_domain_map)은 정답&루브릭 XLSX 기반으로 후속 UPDATE 권장
-- =========================================================

DO $$
DECLARE
  v_sections jsonb := '[{"title": "MIDLOW_STIM_S01", "stimulus": "아프리카의 한 마을에서는 깨끗한 SS 구하기 어려운 상황이 계속되고 있었습니다. 오염된 물을 마신\\n사람들은 심각한 질병에 시달렸고, 특히 어린이들의 건강이 큰 위협을 받았습니다. 이 문제를 해결하기\\n위해 한국의 한 대학 연구팀은 \\"휴대용 물 정화 필터\\"를 개발해 해당 지역에 제공했습니다.\\n이 필터는 플라스틱 병에 연결해 사용할 수 있는 간단한 장치로, 필터를 통해 물을 통과시키면 박테리\\n아와 이물질이 제거되어 깨끗한 물을 마실 수 있었습니다. 제작 비용이 저렴하고 누구나 쉽게 사용할\\n수 있어, 마을 사람들은 이 장치를 통해 건강을 지킬 수 있었습니다.\\n이 MEL 단순히 기술을 제공하는 데 그치지 않고. 사용법을 교육하는 과정에서 마을 주민들이 물의\\n위생과 중요성을 배우는 계기가 되었습니다. 이 사례는 적정기술이 단순히 문제를 해결하는 도구가 아니\\n라, 사람들에게 새로운 살의 기회를 제공하는 방법임을 보여줍니다.", "items": [{"item_code": "MIDLOW_Q01", "item_type": "mcq_single", "stem": "한국 연구팀이 아프리카 마을에 제공한 적정기술로 적절한 것은?", "max_score": "1", "options": ["태양광 랜턴", "박테리아 표본", "태양열 물 펌프", "페자재 단열 패널", "휴대용 물 정화 필터"]}, {"item_code": "MIDLOW_Q02", "item_type": "mcq_single", "stem": "물 정화 필터가 단순히 기술 제공 이상의 효과를 거둔 이유로 적절한 것은?", "max_score": "1", "options": ["0 필터가 비싸지만 효율적이었기 때문이다.", "주민들에게 기술을 무료로 제공했기 때문이다.", "필터가 복잡한 과학 원리를 사용했기 때문이다.", "주민들이 사용법을 배우며 물의 중요성을 이해했기 때문이다.", "세계적으로 인정받는 공신력 있는 대학 연구팀에서 개발했기 때문이다."]}, {"item_code": "MIDLOW_E01", "item_type": "essay", "stem": "여러분이 연구팀의 일원이라면, 아프리카 마을에 어떤 기술을 제공하고 싶은지 구체적으로 서술 하시오. (단, So] 어떤 요소가 부족한 것을 해결하고 싶은지 FS 꼭 설명할 것)", "max_score": "5", "options": []}]}, {"title": "MIDLOW_STIM_S02", "stimulus": "AO CAS 만든다.\\" 이 간단한 STS 8=48라는 SAS HOT 것입니다. KE 800128800(현실\\n화), VE 1900(비젼), DE 00000(꿈)을 뜻합니다. 즉, FS 꾸고 이를 구체적인 비전으로 만들면. 결\\n국 그 비전은 현실이 된다는 것입니다.\\n예를 들어, 한 청소년이 과학자가 되고 싶다는 BS 꾸였다고 가정해 봅시다. 그저 막연히 \\"과학자가 되\\nBARD 생각하는 것만으로는 부족합니다. 대신, 자신이 이루고 싶은 목표를 구체적으로 상상하며\\n계획을 세워야 합니다. “UE 화학 연구소에서 새로운 약물을 개발하는 과학자가 될 거야:\\"라는 비전을\\nPAA, 그 목표를 이루기 위해 어떤 노력을 해야 할지 명확해집니다.\\n이 책은 꿈과 비전을 현실로 만들기 위해 반드시 따라야 할 과정을 설명하며, 독자들에게 “구체적으로\\n상상하라\\"는 메시지를 전달합니다. FS 단순한 희망이 아니라, 여러분을 움직이게 하는 강력한 힘이 될\\n수 있습니다.", "items": [{"item_code": "MIDLOW_Q03", "item_type": "mcq_single", "stem": "RVD BAS 활용하기 위해 필요한 것은?", "max_score": "1", "options": ["막연히 꿈만 꾸며 기다린다.", "실수를 두려워하며 신중히 행동한다.", "목표를 너무 구체적으로 세우지 않는다.", "구체적인 비전을 상상하고 계획을 세운다.", "현재 모습을 고려하여 현실적인 Sus 세운다."]}, {"item_code": "MIDLOW_E02", "item_type": "essay", "stem": "RVD BAS 활용하여 부모님이나 선생님에게 자신의 SES 설명하는 글을 작성하시오.", "max_score": "5", "options": []}]}, {"title": "MIDLOW_STIM_S03", "stimulus": "메이저 영감의 연설은 동물들에게 혁명의 씨앗을 뿌렸다. 그는 동물들이 인간의 억압에서 벗어나 자\\n유롭게 살아가야 한다고 주장하며, \\"모든 SSS BSH LE 이상을 제시했다. 동물들은 메이저 영감\\n의 좋음 이후 그의 이상을 실현하기 위해 인간을 몰아내고 AAS 농장을 운영하기 시작한다. 처음에는\\n모든 동물이 평등한 MIS 꿈꾸며 협력했지만, 시간이 지날수록 상황은 달라졌다.\\n권력을 a $s, 특히 나폴레옹은 점차 자신의 이익을 위해 동물들을 통제하기 시작했다. 나폴레옹\\n은 다른 동물들보다 더 많은 특권을 요구하며, \\"모든 See 평등하지만 어떤 동물들은 더 평등하다.\\"라\\n는 모순된 구호를 내세웠다. 돼지들은 인간의 모습을 닮아갔고. 그들의 지배 방식은 혁명 이전의 인간과\\n다를 바 없게 변질되었다.\\n동물들은 이러한 WIS 알아차리지 못하거나 두려움 때문에 저항하지 못했다. 권력을 sae 돼지들\\n은 동물들을 속이고, 자신들의 행동을 정당화하며 혁명의 이상을 배반했다. 동물농장은 결국 이상과 현\\n실의 MIS 보여주는 상징적인 FAS 변모했다. 이 이야기는 이상적인 사회를 만들기 위해서는 단순한\\n규칙과 구호만으로는 부족하며, 지속적인 감시와 참여가 필요하다는 의미를 전한다.\\n- 『동물농장』, 조지오웰\\n22 -", "items": [{"item_code": "MIDLOW_Q04", "item_type": "mcq_single", "stem": "메이저 영감의 연설에서 동물들에게 강조된 주요 메시지는?", "max_score": "1", "options": ["농장의 확장이 필요하다.", "동물들끼리 경쟁해야 한다.", "HAS] 농장을 운영해야 한다.", "인간과 협력하여 더 나은 농장을 만들자.", "인간의 역압에서 벗어나 자유로운 세상을 만들자."]}, {"item_code": "MIDLOW_Q05", "item_type": "mcq_single", "stem": "\\"돼지들이 GOH! 인간의 모습\\"이 상징하는 내용으로 가장 적절한 것은?", "max_score": "1", "options": ["인간과의 화해 시도", "동물들의 자발적 선택", "진화의 자연스러운 과정", "농장 관리의 효율성 증대", "권력 획득 후의 부패 과정"]}, {"item_code": "MIDLOW_Q06", "item_type": "mcq_single", "stem": "나폴레옹의 \\"모든 EFS 평등하지만 어떤 동물들은 더 평등하다.\\"라는 구호의 논리적 vege?", "max_score": "1", "options": ["혁명을 부정한다.", "차별을 정당화한다.", "동물의 Bag 무시한다.", "인간의 우월성을 인정한다.", "평등의 개념 자체를 부정한다."]}, {"item_code": "MIDLOW_E03", "item_type": "essay", "stem": "이야기 속 동물들이 겪은 일을 바탕으로, 오늘날 우리 사회에 주는 교훈을 서술하시오.", "max_score": "5", "options": []}]}, {"title": "MIDLOW_STIM_S04", "stimulus": "인공지능이 인간의 Was 대체할 것이라는 우려가 커지고 있다. 특히 반복적이고 정형화된 업무는\\n인공지능이 인간보다 더 정확하고 효율적으로 처리할 수 있다. 그러나 이러한 변화를 부정적으로만 볼\\n것이 아니라, 새로운 기회로 바라볼 필요가 있다. 산업혁명 시대에도 기계가 인간의 노동을 대체할 것이\\n라는 불안이 있었지만, 결과적으로 새로운 직업이 생겨났고 인간의 노동은 더 창의적이고 가치 있는 영\\n역으로 발전했다.\\n인공지능은 데이터를 기반으로 학습하고 판단하기 때문에, 창의성이나 감성, 윤리적 판단이 필요한 영\\n역에서는 한계를 보인다. 따라서 미래 사회에서는 인공지능과 협력하면서 인간만이 가진 고유한 능력을\\n발휘할 수 있는 직업이 더욱 중요해질 것이다. 예를 들어, 예술가, 상담가, 교육자와 같이 공감능력과 창\\n의성이 필요한 직업은 여전히 인간의 영역으로 남을 것이다.\\n우리는 인공지능 시대에 적응하기 위해 새로운 역량을 길러야 한다. 단순 암기나 반복적인 기술보다는\\n비판적 사고력, 창의력, 의사소통능력, 협업능력 Sol 더욱 중요해질 것이다. 또한 평생학습을 통해 지속\\n적으로 새로운 지식과 기술을 습득하는 자세가 필요하다.\\n29 -", "items": [{"item_code": "MIDLOW_Q07", "item_type": "mcq_single", "stem": "이 글에서 언급된 미래 사회에서 중요해질 역량이 아닌 것은?", "max_score": "1", "options": ["o 창의력", "wa", "협업 능력", "비판적 사고력", "의사소통 능력"]}, {"item_code": "MIDLOW_Q08", "item_type": "mcq_single", "stem": "\'정형화된 업무\'의 의미와 가장 가까운 것은?", "max_score": "1", "options": ["협업이 중심이 되는 업무", "패턴화되어 반복되는 업무", "즉흥적인 대응이 필요한 업무", "창의적인 사고가 필요한 업무", "고도의 전문성이 요구되는 업무"]}, {"item_code": "MIDLOW_Q09", "item_type": "mcq_single", "stem": "이 글의 내용을 바탕으로 추론할 수 있는 것은?", "max_score": "1", "options": ["현재의 교육 시스템을 유지해야 한다.", "감성적 능력이 더욱 중요해질 것이다.", "인공 지능 기술 VAS 제한해야 한다.", "모든 직업이 인공지능으로 대체될 것이다.", "산업혁명은 일자리 감소의 주된 원인이었다."]}, {"item_code": "MIDLOW_E04", "item_type": "essay", "stem": "위 글에서 예측하는 미래사회의 BSS 요약하고, 학생들이 미래사회를 대비하기 위해 어떤 역 BS 갖추어야 할지에 대해 서술하시오.", "max_score": "5", "options": []}, {"item_code": "MIDLOW_Q10", "item_type": "mcq_single", "stem": "이 글에 대한 반대 의견으로 가장 적절한 것은?", "max_score": "1", "options": ["인공지능의 명확한 정의가 무엇인지 정확한 AVS 보완했으면 해요.", "인공지능이 사람의 직업을 대체하는 과정이 논리적으로 타당하지 못해요.", "인공지능은 그럴듯한 정보를 만들어내는 것일 뿐 정확하지 않다는 문제가 있어요.", "반복적이고 정형화된 업무가 인공지능이 인간보다 더 정확하다는 근거가 부족해요.", "인공지능이 현재 창의성, 감성이 필요한 영역에서 한계가 있으나 미래에도 그렬 것이라 보기 어렵다."]}, {"item_code": "MIDLOW_Q11", "item_type": "mcq_single", "stem": "이 글의 상황에 대해서 드러나는 관점으로 가장 적절한 것은?", "max_score": "1", "options": ["현실에 대한 비관적 우려", "미래에 대한 중립적 관찰", "변화에 대한 긍정적 전망", "과거에 대한 그리운 감정", "미래 기술 발전에 대한 강한 거부감"]}, {"item_code": "MIDLOW_Q12", "item_type": "mcq_single", "stem": "이 글의 내용에 대해 토론할 때 가장 적절한 질문은?", "max_score": "1", "options": ["문장 구조의 SYS 무엇인가?", "글쓴이의 개인적 경험은 무엇인가?", "산업혁명의 역사적 배경은 무엇인가?", "인공지능의 기술적 Wee 무엇인가?", "미래 사회에서 인간만의 Des 역량은 무엇인가?"]}, {"item_code": "MIDLOW_E05", "item_type": "essay", "stem": "인공지능의 VSS 인해 일자리를 잃은 사람에게 보내는 \'위로하는 Je 작성하시오. (단, 일자리를 잃은 사람의 YS 공감하는 관점으로 작성할 것)", "max_score": "5", "options": []}]}, {"title": "MIDLOW_STIM_S05", "stimulus": "어떤 왕이 Yo] 들었는데 암사자의 젖을 먹어야 FE 병이었다.\\n영리한 신하가 사자가 있는 동굴에서 있다가 다친 어린 사자의 몸을 치료해 주고 어미가 있는 동굴로\\n보내주었다. 그리고 신하는 어런 사자들과 친하게 지냈다. 그 모습을 본 어미 사자는 신하와 가까워졌고\\n신하는 사자의 젖을 짜낼 수 있었다.\\n신하가 왕궁으로 돌아오는 길에 그의 몸의 각 부분들이 서로 가장 중요한 일을 했다며 언쟁을 했다.\\n발은 자신이 사자가 있는 동굴까지 걸어갔다고 하고 눈은 자기가 없었다면 아무것도 볼 수 없었다고 하\\n고 심장은 자기가 아니었다면 사자에게 갈 엄두도 못 냈을 거라고 하고 손은 손대로 귀는 귀대로 머리\\n는 머리대로 자신들이 가장 중요한 ALS 했다고 언쟁이 붙었다.\\n혀도 말을 했다. \\"대가 말을 할 수 없었다면 아무런 소용이 없었을 거야.\\"\\n그러자 몸의 부위들이 혀에게 OSA.\\n뻐도 없고 아무 소용도 없는 작은 것이 건방지게 군다는 이야기를 들은 혀는 아무 말도 하지 않고 다\\n음날 궁전에 가서 왕 앞에서 이것은 개의 젖이라고 말을 했다.\\n그러자 혀를 VSG Bo} 각 부분들은 그제야 혀가 얼마나 중요한지 혀가 얼마나 힘이 큰지를 깨\\n닫고 혀에게 잘못을 Welch. 혀는 잘못을 비는 So 각 부분들의 모습을 보고 다시 왕에게 말했다.\\n\\"아니요, 제가 말을 잘못했습니다. 이것은 Bago] 암사자의 젖이옵니다.\\"\\n- 『탈무드』, 작자 미상", "items": [{"item_code": "MIDLOW_Q13", "item_type": "mcq_single", "stem": "다른 신체 부위들이 혀를 무시한 근본적인 이유는?", "max_score": "1", "options": ["혀가 무능했기 때문에", "신하가 평소 BS 잘 해서", "a7} 평소 역할을 하지 않아서", "각자의 역할만을 중요하게 여겨서", "신하가 사자의 젖을 짜내는 공을 세워서"]}, {"item_code": "MIDLOW_Q14", "item_type": "mcq_single", "stem": "앞뒤 맥락을 고려하였을 때 63의 의미로 가장 적절한 것은?", "max_score": "1", "options": ["혀의 주장을 듣고, 부드럽게 설득했다.", "각자의 주장을 펼치며, 조용히 이야기했다.", "신제 부위들의 BAS 고려하여. 친절하게 부탁했다.", "AS 무시하며 비난하는 것을 보아, 강압적으로 압박하였다.", "공을 세운 것에 대한 차분한 SE] 이루어져, 타당한 이유를 들어 설득했다."]}, {"item_code": "MIDLOW_E06", "item_type": "essay", "stem": "신체 부위 중 WS 골라 각각의 주장을 인용하고, 반박하는 IAS 서술하시오.", "max_score": "5", "options": []}, {"item_code": "MIDLOW_Q15", "item_type": "mcq_single", "stem": "혀가 처음에 \'깨의 젖\\"이라고 말한 이유로 가장 적절한 것은?", "max_score": "1", "options": ["실수로 잘못 말했다.", "왕을 속이려고 한 것이다.", "사실을 말할 자신이 없어서이다.", "개의 젖이 더 좋다고 생각해서이다.", "자신의 가치를 증명하기 위해서이다."]}, {"item_code": "MIDLOW_Q16", "item_type": "mcq_single", "stem": "혀가 선택한 문제 해결 방식의 특징은?", "max_score": "1", "options": ["상대방의 주장에 즉각적 대응했다.", "자신의 가치를 실천적으로 증명했다.", "서로 다른 주장을 상호 존중으로 화합했다.", "상호 간의 갈등이 있는 문제 상황을 회피했다.", "상대 주장의 반레를 제시하여 논리적 Bee 지적했다."]}, {"item_code": "MIDLOW_Q17", "item_type": "mcq_single", "stem": "이야기 속 등장인물들의 감정 변화 과정으로 가장 적절한 것은?", "max_score": "1", "options": ["갈등 > 대립 > 화해", "협력 > 대립 > 복수", "오만 > 대립 > 굴복", "우호 > 배신 > 화해", "대립 > 침묵 - 승리"]}, {"item_code": "MIDLOW_Q18", "item_type": "mcq_single", "stem": "이 Zo] 우화 BAS) 이야기로 제시됨에 따라 얻을 수 있는 장점으로 가장 적절한 것은?", "max_score": "1", "options": ["짧고 간결하여 쉽게 읽고 교훈을 주기 위해", "일상과는 다른 강렬한 이미지로 기역에 오래 남아서", "인간 사회의 SAS 상세하고 복잡하게 표현할 수 있어서", "현실과의 차이를 강조하여 환상적인 분위기를 만들기 위해", "다양한 문화 차이를 극복하고 보편적인 메시지를 주기 위해"]}, {"item_code": "MIDLOW_E07", "item_type": "essay", "stem": "위 글의 내용을 일부 인용하여 상대방을 효과적으로 설득하기 위한 방법에 대해 서술하시오.", "max_score": "5", "options": []}]}]'::jsonb;
  v_sec jsonb;
  v_item jsonb;
  v_stim_id bigint;
  v_item_id bigint;
  v_opt text;
  v_i int;
BEGIN
  -- 중복 적재 방지(동일 item_code가 이미 있으면 스킵)
  FOR v_sec IN SELECT * FROM jsonb_array_elements(v_sections)
  LOOP
    INSERT INTO public.stimuli(title, content_type, content_text, assets_json, source_meta_json)
    VALUES (
      (v_sec->>'title'),
      'text',
      (v_sec->>'stimulus'),
      '{}'::jsonb,
      jsonb_build_object('source','리딩 PRO 문해력 진단 평가 [중등 저] 문항지 (1020)')
    )
    RETURNING stimulus_id INTO v_stim_id;

    FOR v_item IN SELECT * FROM jsonb_array_elements(v_sec->'items')
    LOOP
      -- 이미 존재하면 스킵
      IF EXISTS (SELECT 1 FROM public.item_bank WHERE item_code = (v_item->>'item_code')) THEN
        CONTINUE;
      END IF;

      INSERT INTO public.item_bank(
        item_code, grade_band, item_type, stimulus_id, stem,
        max_score, difficulty_level, constraints_json, is_active
      )
      VALUES (
        (v_item->>'item_code'),
        '중저',
        (v_item->>'item_type'),
        v_stim_id,
        (v_item->>'stem'),
        (v_item->>'max_score')::numeric,
        NULL,
        '{}'::jsonb,
        true
      )
      RETURNING item_id INTO v_item_id;

      IF (v_item->>'item_type') LIKE 'mcq%%' THEN
        v_i := 1;
        FOR v_opt IN SELECT * FROM jsonb_array_elements_text(v_item->'options')
        LOOP
          INSERT INTO public.item_options(item_id, label, option_text, display_order)
          VALUES (v_item_id, v_i::text, v_opt, v_i);
          v_i := v_i + 1;
        END LOOP;
      END IF;
    END LOOP;
  END LOOP;
END $$;
